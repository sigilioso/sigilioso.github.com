<!DOCTYPE html>
<html lang="en">
    <head>
        <title>PIL installation problems on CentOS 6</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="./theme/css/main.css" type="text/css" />
        <link href='http://fonts.googleapis.com/css?family=Press+Start+2P' rel='stylesheet' type='text/css'>
        
        <!--[if IE]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
        <!--[if lte IE 7]>
        <link rel="stylesheet" type="text/css" media="all" href="./css/ie.css"/>
        <script src="./js/IE8.js" type="text/javascript"></script><![endif]-->
        <!--[if lt IE 7]>
        <link rel="stylesheet" type="text/css" media="all" href="./css/ie6.css"/><![endif]-->
    </head>
    <body id="index" class="home">
        <header id="banner" class="body">
        <h1><a href=".">sigilioso </a></h1>
        <nav><ul>
            
            
            
            <li><a href="./pages/portfolio.html">Portfolio</a></li>
            
            
            
            <li class="active"><a href="./">dev</a></li>
            
        </ul></nav>
        </header>
        
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="pil-installation-problems-on-centos-6.html" rel="bookmark"
           title="Permalink to PIL installation problems on CentOS 6">PIL installation problems on CentOS 6</a></h1>
      
    </header>
    <div class="entry-content">
      <p>Installing Python Image Library on CentOS 6 seems easy but It could be a pain if particular problems show up.</p>
<p>I tried to install it using pip.</p>
<div class="codehilite"><pre><span class="n">pip</span> <span class="n">install</span> <span class="n">pil</span>
</pre></div>


<p>But it was installed without JPEG support. So, if you try to manipulate JPEG images you will get an error: <code>decoder jpeg not available</code>.</p>
<p>In order to install JPEG support for PIL you need to install <code>libjpeg</code> and <code>libjpeg-devel</code> libraries.</p>
<div class="codehilite"><pre><span class="n">yum</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">libjpeg</span> <span class="n">libjpeg</span><span class="o">-</span><span class="n">devel</span>
</pre></div>


<p>Then, you need to remove PIL from your system and install it again with JPEG support.</p>
<div class="codehilite"><pre>$ <span class="n">pip</span> <span class="n">uninstall</span> <span class="n">pil</span>
</pre></div>


<p>But when I tried to install PIL again, just using pip, it didn't work. So I tried the source code installation.</p>
<div class="codehilite"><pre>$ <span class="n">wget</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">effbot</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="n">downloads</span><span class="o">/</span><span class="n">Imaging</span><span class="o">-</span>1<span class="p">.</span>1<span class="p">.</span>7<span class="p">.</span><span class="n">tar</span><span class="p">.</span><span class="n">gz</span>
$ <span class="n">tar</span> <span class="n">xvzf</span> <span class="n">Imaging</span><span class="o">-</span>1<span class="p">.</span>1<span class="p">.</span>7<span class="p">.</span><span class="n">tar</span><span class="p">.</span><span class="n">gz</span>
$ <span class="n">cd</span> <span class="n">PIL</span><span class="o">-</span>1<span class="p">.</span>1<span class="p">.</span>7
$ <span class="n">python</span> <span class="n">setup</span><span class="p">.</span><span class="n">py</span> <span class="n">install</span>
</pre></div>


<p>Again, it didn't work. That was because you need to tell PIL where to find JPEG and ZLIB libraries. To do so, you have to edit <code>setup.py</code>, including those libraries locations as follows:</p>
<div class="codehilite"><pre><span class="n">TCL_ROOT</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">JPEG_ROOT</span> <span class="o">=</span> <span class="s">&#39;/usr/lib64&#39;</span><span class="p">,</span> <span class="s">&#39;/usr/include&#39;</span>
<span class="n">ZLIB_ROOT</span> <span class="o">=</span> <span class="s">&#39;/lib64&#39;</span><span class="p">,</span> <span class="s">&#39;/usr/include&#39;</span>
<span class="n">TIFF_ROOT</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">FREETYPE_ROOT</span> <span class="o">=</span> <span class="s">&#39;/usr/lib64&#39;</span><span class="p">,</span><span class="s">&#39;/usr/include/freetype2/freetype&#39;</span>
<span class="n">LCMS_ROOT</span> <span class="o">=</span> <span class="bp">None</span>
</pre></div>


<p>Then you can compile and try PIL getting satisfactory results:</p>
<div class="codehilite"><pre>$ <span class="n">python</span> <span class="n">setup</span><span class="p">.</span><span class="n">py</span> <span class="n">build_ext</span> <span class="o">-</span><span class="nb">i</span>

$ <span class="n">python</span> <span class="n">selftest</span><span class="p">.</span><span class="n">py</span>
<span class="o">--------------------------------------------------------------------</span>
<span class="n">PIL</span> 1<span class="p">.</span>1<span class="p">.</span>7 <span class="n">TEST</span> <span class="n">SUMMARY</span>
<span class="o">--------------------------------------------------------------------</span>
<span class="n">Python</span> <span class="n">modules</span> <span class="n">loaded</span> <span class="n">from</span> <span class="o">./</span><span class="n">PIL</span>
<span class="n">Binary</span> <span class="n">modules</span> <span class="n">loaded</span> <span class="n">from</span> <span class="o">./</span><span class="n">PIL</span>
<span class="o">--------------------------------------------------------------------</span>
<span class="o">---</span> <span class="n">PIL</span> <span class="n">CORE</span> <span class="n">support</span> <span class="n">ok</span>
<span class="o">---</span> <span class="n">TKINTER</span> <span class="n">support</span> <span class="n">ok</span>
<span class="o">---</span> <span class="n">JPEG</span> <span class="n">support</span> <span class="n">ok</span>
<span class="o">---</span> <span class="n">ZLIB</span> <span class="p">(</span><span class="n">PNG</span><span class="o">/</span><span class="n">ZIP</span><span class="p">)</span> <span class="n">support</span> <span class="n">ok</span>
<span class="o">---</span> <span class="n">FREETYPE2</span> <span class="n">support</span> <span class="n">ok</span>
<span class="o">---</span> <span class="n">LITTLECMS</span> <span class="n">support</span> <span class="n">ok</span>
<span class="o">--------------------------------------------------------------------</span>
</pre></div>


<p>Then run again <code>python setup.py install</code> and it's done.</p>
<p>This should be enough but I have a couple more issues. When I tried some code to crop images, I still got the error for JPEG images. It happened because I imported I directly imported <code>Image</code> in my python script.</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">Image</span>
<span class="o">...</span>
</pre></div>


<p>But It has to be imported from PIL</p>
<div class="codehilite"><pre><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="o">...</span>
</pre></div>


<p>Then I have no problems to run my script as root, but when I tried to run it as a different user I got the same error. To fix this I unistalled PIP and I installed it again using pip but changing <code>setup.py</code> as commented above.</p>
<div class="codehilite"><pre>$ <span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">I</span> <span class="n">pil</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">install</span>
</pre></div>


<p>Then edit <code>setup.py</code> and install the library</p>
<div class="codehilite"><pre>$ <span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">I</span> <span class="n">pil</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">download</span>
</pre></div>
    </div>
    
    

  </article>
</section>

        <section id="extras" class="body">
        
        </section><!-- /#extras -->
        <footer id="contentinfo" class="body">
        
        <address id="about" class="primary">
            <strong>Christian Felipe √Ålvarez</strong>
            
            <a href="http://github.com/sigilioso">github</a>  - 
            
            <a href="http://twitter.com/chfelipe">twitter</a>  - 
            
            <a href="http://www.linkedin.com/in/chfelipe/en">linkedin</a>  - 
            
            <a href="https://springpad.com/#!/sigilioso/notebooks/howtotips-5f96/">springpad</a> 
            
        </address>
        
        </footer>
        
    </body>
</html>